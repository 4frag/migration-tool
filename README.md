# PostgreSQL Schema Sync Tool

–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–≤—É—Ö –±–∞–∑ –¥–∞–Ω–Ω—ã—Ö PostgreSQL. –ü–æ–∑–≤–æ–ª—è–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ ¬´—Ü–µ–ª–µ–≤—É—é¬ª –ë–î –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Å ¬´—ç—Ç–∞–ª–æ–Ω–Ω–æ–π¬ª, —Å–æ—Ö—Ä–∞–Ω—è—è –ø—Ä–∏ —ç—Ç–æ–º –≤–∞–∂–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ.
## üöÄ –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- Alembic-powered: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –¥–≤–∏–∂–æ–∫ Alembic –¥–ª—è –≤—ã—Å–æ–∫–æ—Ç–æ—á–Ω–æ–≥–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è —Å—Ö–µ–º (—Ç–∞–±–ª–∏—Ü—ã, –∫–æ–ª–æ–Ω–∫–∏, —Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö, –∏–Ω–¥–µ–∫—Å—ã, FK).

- No-Model Approach: –ù–µ —Ç—Ä–µ–±—É–µ—Ç –æ–ø–∏—Å–∞–Ω–∏—è SQLAlchemy-–º–æ–¥–µ–ª–µ–π. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —ç—Ç–∞–ª–æ–Ω–Ω–æ–π –ë–î —Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è ¬´–Ω–∞ –ª–µ—Ç—É¬ª —á–µ—Ä–µ–∑ Reflection.

- Safety First (Backups): –ü—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —Ç–∞–±–ª–∏—Ü –∏–ª–∏ –∫–æ–ª–æ–Ω–æ–∫ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç –±—ç–∫–∞–ø-–∫–æ–ø–∏–∏ –¥–∞–Ω–Ω—ã—Ö –≤ —Ç–æ–π –∂–µ –ë–î —Å –ø—Ä–µ—Ñ–∏–∫—Å–æ–º bak_.

- –£–º–Ω–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ PK: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞—Ö–æ–¥–∏—Ç Primary Key –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ç–æ—á–µ—á–Ω—ã—Ö –±—ç–∫–∞–ø–æ–≤ —É–¥–∞–ª—è–µ–º—ã—Ö –∫–æ–ª–æ–Ω–æ–∫.

- –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω–æ—Å—Ç—å: –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è (DDL) –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –≤ —Ä–∞–º–∫–∞—Ö –æ–¥–Ω–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏. –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ–π–¥–µ—Ç –Ω–µ —Ç–∞–∫, –±–∞–∑–∞ –æ—Ç–∫–∞—Ç–∏—Ç—Å—è –∫ –∏—Å—Ö–æ–¥–Ω–æ–º—É —Å–æ—Å—Ç–æ—è–Ω–∏—é.

- Cross-platform: –ü–æ–ª–Ω–æ—Å—Ç—å—é –Ω–∞–ø–∏—Å–∞–Ω –Ω–∞ Python, –Ω–µ —Ç—Ä–µ–±—É–µ—Ç bash-—Å–∫—Ä–∏–ø—Ç–æ–≤ –∏ –≥–æ—Ç–æ–≤ –∫ –∑–∞–ø—É—Å–∫—É –Ω–∞ Windows –∏ Linux.

## üìã –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –≤ –≤–∏–¥–µ –∫–ª–∞—Å—Å–∞ DatabaseSyncer. –î–ª—è –∑–∞–ø—É—Å–∫–∞ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –≤—ã–∑–≤–∞—Ç—å –º–µ—Ç–æ–¥ sync_databases.
```
from src.database_syncer import DatabaseSyncer

SOURCE_DB = "postgresql://user:pass@localhost:5432/reference_db"
TARGET_DB = "postgresql://user:pass@localhost:5432/target_db"

# –†–µ–∂–∏–º –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ (Dry-run) - –ø–æ–∫–∞–∂–µ—Ç, —á—Ç–æ –∏–∑–º–µ–Ω–∏—Ç—Å—è, –±–µ–∑ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è
DatabaseSyncer.sync_databases(SOURCE_DB, TARGET_DB, dry_run=True)

# –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π
DatabaseSyncer.sync_databases(SOURCE_DB, TARGET_DB, dry_run=False)
```
–¢–∞–∫–∂–µ –µ—Å—Ç—å cli
```
# dry run
python -m src.main  'postgresql://example:1@localhost/reference' 'postgresql://example:1@localhost/target'
# –ø—Ä–∏–º–µ–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
python -m src.main  'postgresql://example:1@localhost/reference' 'postgresql://example:1@localhost/target' --apply
```

–¢–∞–∫–∂–µ –µ—Å—Ç—å –ø—Ä–∏–º–µ—Ä—ã —Å—Ö–µ–º –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ —Ä–∞–±–æ—Ç—ã –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞. –î–ª—è –∏—Ö –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:
- –∑–∞–ø—É—Å–∫–∞–µ–º docker-compose: `docker-compose up -d`
- –∑–∞—Ö–æ–¥–∏–º –≤ shell –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö: `psql -U example -d postgres`
- –ø–æ–æ—á–µ—Ä–µ–¥–Ω–æ —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –±–¥ –∏–∑ `db_schemas` –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç—å
- –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å cli –∏–∑ –ø—Ä–∏–º–µ—Ä–∞ –≤—ã—à–µ


## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è
- –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏

    - –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∏: –û–ø–µ—Ä–∞—Ü–∏–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ö–µ–º—ã (ALTER TABLE) —Ç—Ä–µ–±—É—é—Ç —É—Ä–æ–≤–Ω—è –¥–æ—Å—Ç—É–ø–∞ ACCESS EXCLUSIVE. –ù–∞ –≤—ã—Å–æ–∫–æ–Ω–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü–∞—Ö —ç—Ç–æ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –∫—Ä–∞—Ç–∫–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–º—É –æ–∂–∏–¥–∞–Ω–∏—é –∑–∞–ø—Ä–æ—Å–æ–≤.

    - –û–±—ä–µ–º –¥–∞–Ω–Ω—ã—Ö: –°–æ–∑–¥–∞–Ω–∏–µ –±—ç–∫–∞–ø–∞ —á–µ—Ä–µ–∑ CREATE TABLE AS SELECT –Ω–∞ –æ—á–µ–Ω—å –±–æ–ª—å—à–∏—Ö —Ç–∞–±–ª–∏—Ü–∞—Ö –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å –≤—Ä–µ–º—è –∏ –¥–∏—Å–∫–æ–≤–æ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ. –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∑–∞–ø—É—Å–∫–∞—Ç—å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –≤ –ø–µ—Ä–∏–æ–¥—ã –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–π –Ω–∞–≥—Ä—É–∑–∫–∏.

- –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

    - –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–æ–≤–µ—Ä—è–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä–µ —ç—Ç–∞–ª–æ–Ω–Ω–æ–π –ë–î. –í—Å–µ –∏–º–µ–Ω–∞ –æ–±—ä–µ–∫—Ç–æ–≤ —ç–∫—Ä–∞–Ω–∏—Ä—É—é—Ç—Å—è –¥–≤–æ–π–Ω—ã–º–∏ –∫–∞–≤—ã—á–∫–∞–º–∏ –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç —Å–ø–µ—Ü–∏—Ñ–∏—á–µ—Å–∫–∏—Ö –∏–º–µ–Ω –≤ PostgreSQL –∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã —Å —Ä–µ–≥–∏—Å—Ç—Ä–æ–º.